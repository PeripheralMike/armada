{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Metadata":{
      
   },
   "Resources":{
      
    
    "LaunchTemplate":{
         "Type":"AWS::EC2::LaunchTemplate",
         "DependsOn":["SubnetA","VPC","SecurityGroup"],
         "Properties":{
            "LaunchTemplateData":{
               "ImageId":"ami-07ee42ba0209b6d77",
               "InstanceType":"t2.large",
               "UserData" : "IyEvYmluL2Jhc2gKIyBVc2VyIGRhdGEgZm9yIHRoZSBKbWV0ZXIgQXJtYWRhIHNlcnZlciBFQzIgaW5zdGFuY2Ugd2l0aGluIHRoZSBzcG90IGZsZWV0CiMgVGhpcyBpbmZvcm1hdGlvbiB3aWxsIGJlIGJhc2U2NCBlbmNvZGVkIGFuZCB1c2VkIGluIHRoZSAnY29uZmlnLmpzb24gZmlsZQoKIyBzZXQgaXAgYXMgZW52IHZhciAtIHRoaXMgaXMgaW1wb3J0YW50IGZvciBydW5uaW5nIHRoZSBqbWV0ZXIgdGVzdHMgaW4gYSBkaXN0cmlidXRlZCBzdHlsZQplY2hvICJleHBvcnQgTE9DQUxJUD0kKGhvc3RuYW1lIC1pKSIgPj4gL2V0Yy9iYXNoLmJhc2hyYwoKc291cmNlIC9ldGMvYmFzaC5iYXNocmMKCiMgdXBkYXRlIHRoZSB1YnVudHUgT1MKCnN1ZG8gYXB0LWdldCB1cGRhdGUgLXkKCiMgaW5zdGFsbCBEb2NrZXIncyBjZXJ0aWZpY2F0ZS4uLgoKc3VkbyBhcHQtZ2V0IGluc3RhbGwgXAogICAgYXB0LXRyYW5zcG9ydC1odHRwcyBcCiAgICBjYS1jZXJ0aWZpY2F0ZXMgXAogICAgY3VybCAteSBcCiAgICBzb2Z0d2FyZS1wcm9wZXJ0aWVzLWNvbW1vbgoKIyBhZGQgZG9ja2VycyBvZmZpY2lhbCBHUEcga2V5CmN1cmwgLWZzU0wgaHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL2xpbnV4L3VidW50dS9ncGcgfCBzdWRvIGFwdC1rZXkgYWRkIC0KCiMgc2V0IHVwIHRoZSBzdGFibGUgcmVwb3NpdG9yeQpzdWRvIGFkZC1hcHQtcmVwb3NpdG9yeSBcCiAgICJkZWIgW2FyY2g9YW1kNjRdIGh0dHBzOi8vZG93bmxvYWQuZG9ja2VyLmNvbS9saW51eC91YnVudHUgXAogICAkKGxzYl9yZWxlYXNlIC1jcykgXAogICBzdGFibGUiCgojIHVwZGF0ZSBhZ2FpbiBub3cgd2l0aCBhZGRlZCByZXBvCnN1ZG8gYXB0LWdldCB1cGRhdGUgLXkKCiMgSW5zdGFsbCBEb2NrZXIgQ0UgCnN1ZG8gYXB0LWdldCBpbnN0YWxsIGRvY2tlci1jZSAteQoKIyBpbnN0YWxsIGRvY2tlci1jb21wb3NlIChpbiBjYXNlIHlvdSBuZWVkIHRvIG1ha2UgYSBkb2NrZXItY29tcG9zZSBmaWxlKQpzdWRvIGFwdC1nZXQgaW5zdGFsbCBkb2NrZXItY29tcG9zZSAteQoKIyBtYWtlIGRvY2tlciBncm91cCBpZiBub3QgYWxyZWFkeSBjcmVhdGVkCnN1ZG8gZ3JvdXBhZGQgZG9ja2VyCgojIG1ha2UgdWJ1bnR1IHVzZXIgcGFydCBvZiBkb2NrZXIgZ3JvdXAKc3VkbyB1c2VybW9kIC1hRyBkb2NrZXIgdWJ1bnR1CgojIGluc3RhbGwgaHRvcCAodGhpcyBpcyBmb3Igc3lzdGVtIG1vbml0b3JpbmcgLSB0byB1c2UganVzdCB0eXBlIGluICdodG9wJyBvbiB0aGUgQ0xJKQpzdWRvIGFwdCBpbnN0YWxsIGh0b3AKCiMgU3RlcCBoZXJlIHRvIGluc3RhbGwgam1ldGVyCgojU3RlcCBoZXJlIHRvIHN0YXJ0IGptZXRlcgoKc3VkbyBta2RpciAvaG9tZS91YnVudHUvU0VSVkVS",
               "KeyName" : "armada-sandbox",
               "NetworkInterfaces": [
                  {
                     "DeviceIndex": 0,
                     "SubnetId":{"Ref":"SubnetA"},
                     "Groups": [{"Ref":"SecurityGroup"}]
                  }
              ]
            },
            "LaunchTemplateName":"Testingname"
         }
      },
      "VPC":{
         "Type":"AWS::EC2::VPC",
         "Properties":{
            "CidrBlock":"172.31.0.0/16",
            "EnableDnsSupport":"true",
            "EnableDnsHostnames":"true",
            "InstanceTenancy":"default"
         }
      },
      "InternetGateway":{
         "Type":"AWS::EC2::InternetGateway"
      },
      "VPCGatewayAttachment":{
         "Type":"AWS::EC2::VPCGatewayAttachment",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "InternetGatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "SubnetA":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "CidrBlock":"172.31.0.0/20",
            "MapPublicIpOnLaunch":true
         }
      },
   
   "RouteTable":{
      "Type":"AWS::EC2::RouteTable",
      "Properties":{
         "VpcId":{
            "Ref":"VPC"
         }
      }
   },
   "InternetRoute":{
      "Type":"AWS::EC2::Route",
      "DependsOn":"VPCGatewayAttachment",
      "Properties":{
         "DestinationCidrBlock":"0.0.0.0/0",
         "GatewayId":{
            "Ref":"InternetGateway"
         },
         "RouteTableId":{
            "Ref":"RouteTable"
         }
      }
   },
   "SubnetARouteTableAssociation":{
      "Type":"AWS::EC2::SubnetRouteTableAssociation",
      "Properties":{
         "RouteTableId":{
            "Ref":"RouteTable"
         },
         "SubnetId":{
            "Ref":"SubnetA"
         }
      }
   },
   "SecurityGroup":{
      "Type":"AWS::EC2::SecurityGroup",
      "Properties":{
         "GroupName":"Armada Group",
         "GroupDescription":"jmeter and SSH traffic in, all traffic out.",
         "VpcId":{
            "Ref":"VPC"
         },
         "SecurityGroupIngress":[
            {
               "IpProtocol":"tcp",
               "FromPort":"22",
               "ToPort":"22",
               "CidrIp":"151.226.39.115/32"
            },
            {
               "IpProtocol":"tcp",
               "FromPort":"5000",
               "ToPort":"5000",
               "CidrIp":"0.0.0.0/0"
            },
            {
               "IpProtocol":"tcp",
               "FromPort":"6000",
               "ToPort":"6000",
               "CidrIp":"0.0.0.0/0"
            },
            {
               "IpProtocol":"tcp",
               "FromPort":"1099",
               "ToPort":"1099",
               "CidrIp":"0.0.0.0/0"
            }
         ],
         "SecurityGroupEgress":[
            {
               "IpProtocol":-1,
               "CidrIp":"0.0.0.0/0"
            }
         ]
      }
   },
   "EC2Instance":{
      "Type":"AWS::EC2::Instance",
      "DependsOn":["SubnetA","VPC","SecurityGroup"],
      "Properties":{
         "ImageId":"ami-07ee42ba0209b6d77",
         "SubnetId":{"Ref":"SubnetA"},
         "SecurityGroupIds":[{"Ref":"SecurityGroup"}],
         "KeyName":"armada-sandbox",
         "UserData" : "IyEvYmluL2Jhc2gKIyBVc2VyIGRhdGEgZm9yIHRoZSBKbWV0ZXIgQXJtYWRhIHNlcnZlciBFQzIgaW5zdGFuY2Ugd2l0aGluIHRoZSBzcG90IGZsZWV0CiMgVGhpcyBpbmZvcm1hdGlvbiB3aWxsIGJlIGJhc2U2NCBlbmNvZGVkIGFuZCB1c2VkIGluIHRoZSAnY29uZmlnLmpzb24gZmlsZQoKIyBzZXQgaXAgYXMgZW52IHZhciAtIHRoaXMgaXMgaW1wb3J0YW50IGZvciBydW5uaW5nIHRoZSBqbWV0ZXIgdGVzdHMgaW4gYSBkaXN0cmlidXRlZCBzdHlsZQplY2hvICJleHBvcnQgTE9DQUxJUD0kKGhvc3RuYW1lIC1pKSIgPj4gL2V0Yy9iYXNoLmJhc2hyYwoKc291cmNlIC9ldGMvYmFzaC5iYXNocmMKCiMgdXBkYXRlIHRoZSB1YnVudHUgT1MKCnN1ZG8gYXB0LWdldCB1cGRhdGUgLXkKCiMgaW5zdGFsbCBEb2NrZXIncyBjZXJ0aWZpY2F0ZS4uLgoKc3VkbyBhcHQtZ2V0IGluc3RhbGwgXAogICAgYXB0LXRyYW5zcG9ydC1odHRwcyBcCiAgICBjYS1jZXJ0aWZpY2F0ZXMgXAogICAgY3VybCAteSBcCiAgICBzb2Z0d2FyZS1wcm9wZXJ0aWVzLWNvbW1vbgoKIyBhZGQgZG9ja2VycyBvZmZpY2lhbCBHUEcga2V5CmN1cmwgLWZzU0wgaHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL2xpbnV4L3VidW50dS9ncGcgfCBzdWRvIGFwdC1rZXkgYWRkIC0KCiMgc2V0IHVwIHRoZSBzdGFibGUgcmVwb3NpdG9yeQpzdWRvIGFkZC1hcHQtcmVwb3NpdG9yeSBcCiAgICJkZWIgW2FyY2g9YW1kNjRdIGh0dHBzOi8vZG93bmxvYWQuZG9ja2VyLmNvbS9saW51eC91YnVudHUgXAogICAkKGxzYl9yZWxlYXNlIC1jcykgXAogICBzdGFibGUiCgojIHVwZGF0ZSBhZ2FpbiBub3cgd2l0aCBhZGRlZCByZXBvCnN1ZG8gYXB0LWdldCB1cGRhdGUgLXkKCiMgSW5zdGFsbCBEb2NrZXIgQ0UgCnN1ZG8gYXB0LWdldCBpbnN0YWxsIGRvY2tlci1jZSAteQoKIyBpbnN0YWxsIGRvY2tlci1jb21wb3NlIChpbiBjYXNlIHlvdSBuZWVkIHRvIG1ha2UgYSBkb2NrZXItY29tcG9zZSBmaWxlKQpzdWRvIGFwdC1nZXQgaW5zdGFsbCBkb2NrZXItY29tcG9zZSAteQoKIyBtYWtlIGRvY2tlciBncm91cCBpZiBub3QgYWxyZWFkeSBjcmVhdGVkCnN1ZG8gZ3JvdXBhZGQgZG9ja2VyCgojIG1ha2UgdWJ1bnR1IHVzZXIgcGFydCBvZiBkb2NrZXIgZ3JvdXAKc3VkbyB1c2VybW9kIC1hRyBkb2NrZXIgdWJ1bnR1CgojIGluc3RhbGwgaHRvcCAodGhpcyBpcyBmb3Igc3lzdGVtIG1vbml0b3JpbmcgLSB0byB1c2UganVzdCB0eXBlIGluICdodG9wJyBvbiB0aGUgQ0xJKQpzdWRvIGFwdCBpbnN0YWxsIGh0b3AKCiMgc29tZXRoaW5nIGhlcmUgdG8gaW5zdGFsbCBqbWV0ZXI/CgpzdWRvIG1rZGlyIG1hc3Rlcg=="
         
      }
   },
   "SpotFleet":{
      "Type":"AWS::EC2::SpotFleet",
      "DependsOn":["LaunchTemplate", "SubnetA"], 
      "Properties":{
         "SpotFleetRequestConfigData":{
            "TargetCapacity":1,
            "IamFleetRole":"arn:aws:iam::424956271160:role/AmazonEC2SpotFleetRole",
            "LaunchTemplateConfigs":[
               {
                  "LaunchTemplateSpecification":{
                     "LaunchTemplateName":"Testingname",
                     "Version" : { "Fn::GetAtt" : [ "LaunchTemplate", "LatestVersionNumber" ] }
                       }                     
                  }]
               }
      }
         }
      }
   }